"use strict";(globalThis.webpackChunkrelae_docs=globalThis.webpackChunkrelae_docs||[]).push([[845],{2173:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"guides/dead-letter-queue","title":"Dead Letter Queue (DLQ)","description":"The Dead Letter Queue is where webhook events go after failing all automatic retry attempts. Learn how to review, debug, and manually retry failed events.","source":"@site/docs/guides/dead-letter-queue.md","sourceDirName":"guides","slug":"/guides/dead-letter-queue","permalink":"/guides/dead-letter-queue","draft":false,"unlisted":false,"editUrl":"https://github.com/WillBallentine/relae-docs/tree/main/docs/guides/dead-letter-queue.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Managing Webhooks","permalink":"/guides/managing-webhooks"},"next":{"title":"Verifying Webhook Signatures","permalink":"/guides/verifying-signatures"}}');var r=i(4848),l=i(8453);const t={},d="Dead Letter Queue (DLQ)",o={},a=[{value:"What is the Dead Letter Queue?",id:"what-is-the-dead-letter-queue",level:2},{value:"When Events Move to DLQ",id:"when-events-move-to-dlq",level:2},{value:"Accessing the Dead Letter Queue",id:"accessing-the-dead-letter-queue",level:2},{value:"Understanding the DLQ Table",id:"understanding-the-dlq-table",level:2},{value:"Failed Reasons Explained",id:"failed-reasons-explained",level:2},{value:"Connection Refused",id:"connection-refused",level:3},{value:"Timeout",id:"timeout",level:3},{value:"500 Internal Server Error",id:"500-internal-server-error",level:3},{value:"Invalid SSL Certificate",id:"invalid-ssl-certificate",level:3},{value:"DNS Failure",id:"dns-failure",level:3},{value:"Viewing Event Details",id:"viewing-event-details",level:2},{value:"Full Payload",id:"full-payload",level:3},{value:"Original Headers",id:"original-headers",level:3},{value:"Retry History",id:"retry-history",level:3},{value:"Retrying Events",id:"retrying-events",level:2},{value:"Single Event Retry",id:"single-event-retry",level:3},{value:"Bulk Retry",id:"bulk-retry",level:3},{value:"Searching &amp; Filtering in DLQ",id:"searching--filtering-in-dlq",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Monitor DLQ Daily",id:"1-monitor-dlq-daily",level:3},{value:"2. Fix Root Causes",id:"2-fix-root-causes",level:3},{value:"3. Process Asynchronously",id:"3-process-asynchronously",level:3},{value:"4. Add Idempotency",id:"4-add-idempotency",level:3},{value:"5. Set Up Alerts",id:"5-set-up-alerts",level:3},{value:"Understanding Retry Behavior",id:"understanding-retry-behavior",level:2},{value:"What Gets Retried",id:"what-gets-retried",level:3},{value:"What Changes",id:"what-changes",level:3},{value:"Common Scenarios",id:"common-scenarios",level:2},{value:"Scenario 1: Deployment Downtime",id:"scenario-1-deployment-downtime",level:3},{value:"Scenario 2: Database Connection Issues",id:"scenario-2-database-connection-issues",level:3},{value:"Scenario 3: Wrong Destination URL",id:"scenario-3-wrong-destination-url",level:3},{value:"Scenario 4: Timeout During High Load",id:"scenario-4-timeout-during-high-load",level:3},{value:"Debugging Failed Events",id:"debugging-failed-events",level:2},{value:"Step-by-Step Debugging",id:"step-by-step-debugging",level:3},{value:"Using Event Details for Debugging",id:"using-event-details-for-debugging",level:3},{value:"Data Retention in DLQ",id:"data-retention-in-dlq",level:2},{value:"Preventing DLQ Events",id:"preventing-dlq-events",level:2},{value:"1. Reliable Infrastructure",id:"1-reliable-infrastructure",level:3},{value:"2. Fast Webhook Handlers",id:"2-fast-webhook-handlers",level:3},{value:"3. Error Handling",id:"3-error-handling",level:3},{value:"4. Monitoring",id:"4-monitoring",level:3},{value:"5. Testing",id:"5-testing",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Need Help?",id:"need-help",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dead-letter-queue-dlq",children:"Dead Letter Queue (DLQ)"})}),"\n",(0,r.jsx)(n.p,{children:"The Dead Letter Queue is where webhook events go after failing all automatic retry attempts. Learn how to review, debug, and manually retry failed events."}),"\n",(0,r.jsx)(n.h2,{id:"what-is-the-dead-letter-queue",children:"What is the Dead Letter Queue?"}),"\n",(0,r.jsxs)(n.p,{children:["When a webhook fails to be delivered to your destination after ",(0,r.jsx)(n.strong,{children:"5 automatic retry attempts"})," (over approximately 13 minutes), it's moved to the Dead Letter Queue."]}),"\n",(0,r.jsxs)(n.p,{children:["The DLQ ensures you ",(0,r.jsx)(n.strong,{children:"never lose a webhook event"})," - even when your application is down for extended periods."]}),"\n",(0,r.jsx)(n.h2,{id:"when-events-move-to-dlq",children:"When Events Move to DLQ"}),"\n",(0,r.jsx)(n.p,{children:"Events move to the DLQ when:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Your destination returns 5xx errors consistently"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Your destination times out (30 seconds)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Your destination is unreachable (DNS failure, connection refused)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c SSL/TLS certificate errors"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 All 5 automatic retries have been exhausted"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Retry Timeline",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"1st attempt: Immediate"}),"\n",(0,r.jsx)(n.li,{children:"2nd attempt: After 5 seconds"}),"\n",(0,r.jsx)(n.li,{children:"3rd attempt: After 25 seconds"}),"\n",(0,r.jsx)(n.li,{children:"4th attempt: After 125 seconds (~2 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"5th attempt: After 625 seconds (~10 minutes)"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Then"})," \u2192 Moves to DLQ"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"accessing-the-dead-letter-queue",children:"Accessing the Dead Letter Queue"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Log in to your dashboard"}),"\n",(0,r.jsxs)(n.li,{children:["Click the ",(0,r.jsx)(n.strong,{children:'"Dead Letter Queue"'})," tab"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Dead Letter Queue Dashboard",src:i(3034).A+"",width:"1311",height:"499"})}),"\n",(0,r.jsx)(n.h2,{id:"understanding-the-dlq-table",children:"Understanding the DLQ Table"}),"\n",(0,r.jsx)(n.p,{children:"Each failed event shows:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Column"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Checkbox"})}),(0,r.jsx)(n.td,{children:"Select events for bulk retry"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Source"})}),(0,r.jsx)(n.td,{children:"The vendor that sent the webhook"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Payload"})}),(0,r.jsx)(n.td,{children:"Preview of the webhook data"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Timestamp"})}),(0,r.jsx)(n.td,{children:"When it was originally received"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Failed Reason"})}),(0,r.jsx)(n.td,{children:"Why delivery failed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Retry Button"})}),(0,r.jsx)(n.td,{children:"Manually retry this specific event"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"failed-reasons-explained",children:"Failed Reasons Explained"}),"\n",(0,r.jsx)(n.h3,{id:"connection-refused",children:"Connection Refused"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Your destination server refused the connection\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Application is down"}),"\n",(0,r.jsx)(n.li,{children:"Wrong destination URL"}),"\n",(0,r.jsx)(n.li,{children:"Firewall blocking Relae's IPs"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Verify your destination URL is correct"}),"\n",(0,r.jsx)(n.li,{children:"Ensure your application is running"}),"\n",(0,r.jsx)(n.li,{children:"Check firewall rules"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"timeout",children:"Timeout"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Request timed out after 30 seconds\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Slow database queries in your webhook handler"}),"\n",(0,r.jsx)(n.li,{children:"Processing too much data synchronously"}),"\n",(0,r.jsx)(n.li,{children:"Network latency issues"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Optimize your webhook handler performance"}),"\n",(0,r.jsx)(n.li,{children:"Process webhooks asynchronously (return 200 immediately)"}),"\n",(0,r.jsx)(n.li,{children:"Add database indexes"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"500-internal-server-error",children:"500 Internal Server Error"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Your application returned HTTP 500\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unhandled exception in your code"}),"\n",(0,r.jsx)(n.li,{children:"Database connection issues"}),"\n",(0,r.jsx)(n.li,{children:"Missing required data"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check your application error logs"}),"\n",(0,r.jsx)(n.li,{children:"Add error handling to webhook endpoint"}),"\n",(0,r.jsx)(n.li,{children:"Validate required fields exist"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"invalid-ssl-certificate",children:"Invalid SSL Certificate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"SSL certificate verification failed\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Expired SSL certificate"}),"\n",(0,r.jsx)(n.li,{children:"Self-signed certificate"}),"\n",(0,r.jsx)(n.li,{children:"Certificate chain issues"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Renew your SSL certificate"}),"\n",(0,r.jsx)(n.li,{children:"Use a valid CA-signed certificate"}),"\n",(0,r.jsx)(n.li,{children:"Ensure certificate chain is complete"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dns-failure",children:"DNS Failure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Could not resolve hostname\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Domain doesn't exist"}),"\n",(0,r.jsx)(n.li,{children:"DNS not propagated yet"}),"\n",(0,r.jsx)(n.li,{children:"DNS server issues"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Verify domain is correct"}),"\n",(0,r.jsx)(n.li,{children:"Wait for DNS propagation (up to 48 hours)"}),"\n",(0,r.jsx)(n.li,{children:"Test with curl to confirm DNS works"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"viewing-event-details",children:"Viewing Event Details"}),"\n",(0,r.jsx)(n.p,{children:"Click on any event row to see:"}),"\n",(0,r.jsx)(n.h3,{id:"full-payload",children:"Full Payload"}),"\n",(0,r.jsx)(n.p,{children:"The complete JSON body of the webhook:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "evt_1234567890",\n  "type": "payment_intent.succeeded",\n  "data": {\n    "object": {\n      "id": "pi_1234567890",\n      "amount": 5000\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"original-headers",children:"Original Headers"}),"\n",(0,r.jsx)(n.p,{children:"All headers sent by the vendor:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "content-type": "application/json",\n  "x-stripe-signature": "t=1701234567,v1=abc123...",\n  "user-agent": "Stripe/1.0"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"retry-history",children:"Retry History"}),"\n",(0,r.jsx)(n.p,{children:"See all retry attempts with timestamps and error messages."}),"\n",(0,r.jsx)(n.h2,{id:"retrying-events",children:"Retrying Events"}),"\n",(0,r.jsx)(n.h3,{id:"single-event-retry",children:"Single Event Retry"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Click the ",(0,r.jsx)(n.strong,{children:'"Retry"'})," button on the event row"]}),"\n",(0,r.jsx)(n.li,{children:"Confirm the retry in the modal"}),"\n",(0,r.jsx)(n.li,{children:"Event is immediately reprocessed"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If successful:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Event moves from DLQ to Webhooks tab"}),"\n",(0,r.jsx)(n.li,{children:'\u2705 Status changes to "delivered"'}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If still failing:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Event stays in DLQ"}),"\n",(0,r.jsx)(n.li,{children:"\u274c New failure reason is shown"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"bulk-retry",children:"Bulk Retry"}),"\n",(0,r.jsx)(n.p,{children:"Retry multiple events at once:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check the boxes for events to retry"}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:'"Retry (X)"'})," button in the header"]}),"\n",(0,r.jsx)(n.li,{children:"Confirm bulk retry"}),"\n",(0,r.jsx)(n.li,{children:"All selected events are reprocessed"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Bulk Retry",src:i(7327).A+"",width:"1399",height:"882"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Bulk retry is useful after fixing an issue that affected multiple events (e.g., after a deployment or server restart)."})}),"\n",(0,r.jsx)(n.h2,{id:"searching--filtering-in-dlq",children:"Searching & Filtering in DLQ"}),"\n",(0,r.jsx)(n.p,{children:"Use the search bar to find specific failed events:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stripe"})," - Find all Stripe failures"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"timeout"})," - Find all timeout errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payment_intent"})," - Find specific event types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"500"})," - Find all 500 errors"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-monitor-dlq-daily",children:"1. Monitor DLQ Daily"}),"\n",(0,r.jsx)(n.p,{children:"Check your DLQ regularly for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unexpected failures"}),"\n",(0,r.jsx)(n.li,{children:"Patterns in error messages"}),"\n",(0,r.jsx)(n.li,{children:"Events that need attention"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-fix-root-causes",children:"2. Fix Root Causes"}),"\n",(0,r.jsx)(n.p,{children:"Don't just retry - fix the underlying issue:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Event in DLQ] --\x3e B{Identify cause}\n    B --\x3e|Timeout| C[Optimize handler]\n    B --\x3e|500 error| D[Fix application bug]\n    B --\x3e|Connection refused| E[Start application]\n    B --\x3e|SSL error| F[Renew certificate]\n    C --\x3e G[Test with curl]\n    D --\x3e G\n    E --\x3e G\n    F --\x3e G\n    G --\x3e H[Retry from DLQ]\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-process-asynchronously",children:"3. Process Asynchronously"}),"\n",(0,r.jsx)(n.p,{children:"To avoid timeouts, acknowledge webhooks immediately:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good: Quick acknowledgment\napp.post("/webhooks", async (req, res) => {\n  // Return 200 immediately\n  res.status(200).send("OK");\n\n  // Process asynchronously\n  processWebhookAsync(req.body);\n});\n\n// \u274c Bad: Slow synchronous processing\napp.post("/webhooks", async (req, res) => {\n  await slowDatabaseQuery();\n  await sendEmail();\n  await updateCache();\n  res.status(200).send("OK"); // Too late!\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-add-idempotency",children:"4. Add Idempotency"}),"\n",(0,r.jsx)(n.p,{children:"Handle duplicate retries gracefully:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'app.post("/webhooks", async (req, res) => {\n  const eventId = req.body.id;\n\n  // Check if already processed\n  const exists = await db.findEvent(eventId);\n  if (exists) {\n    return res.status(200).send("Already processed");\n  }\n\n  // Process new event\n  await processWebhook(req.body);\n  await db.saveEvent(eventId);\n\n  res.status(200).send("OK");\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-set-up-alerts",children:"5. Set Up Alerts"}),"\n",(0,r.jsx)(n.p,{children:"Get notified when events hit the DLQ:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check DLQ count daily"}),"\n",(0,r.jsx)(n.li,{children:"Set up monitoring for high failure rates"}),"\n",(0,r.jsx)(n.li,{children:"Create alerts for specific error types"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"understanding-retry-behavior",children:"Understanding Retry Behavior"}),"\n",(0,r.jsx)(n.h3,{id:"what-gets-retried",children:"What Gets Retried"}),"\n",(0,r.jsx)(n.p,{children:"When you retry an event from the DLQ:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Same payload"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Same headers (except timestamps)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Fresh HMAC signature"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 New timestamp in ",(0,r.jsx)(n.code,{children:"X-Relae-Timestamp"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-changes",children:"What Changes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\ud83d\udd04 New attempt timestamp"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\udd04 Fresh signature (verify with current token)"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\udd04 Updated retry count in metadata"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-1-deployment-downtime",children:"Scenario 1: Deployment Downtime"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Situation:"})," You deployed new code and your app was down for 20 minutes. 100 events in DLQ."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Verify deployment is successful"}),"\n",(0,r.jsxs)(n.li,{children:["Test with curl: ",(0,r.jsx)(n.code,{children:"curl -X POST your-destination-url"})]}),"\n",(0,r.jsx)(n.li,{children:"Select all events in DLQ"}),"\n",(0,r.jsx)(n.li,{children:"Bulk retry"}),"\n",(0,r.jsx)(n.li,{children:"Monitor for successful delivery"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-2-database-connection-issues",children:"Scenario 2: Database Connection Issues"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Situation:"})," Database was down, webhooks returning 500 errors."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Fix database connection"}),"\n",(0,r.jsx)(n.li,{children:"Add connection retry logic to app"}),"\n",(0,r.jsx)(n.li,{children:"Test webhook endpoint works"}),"\n",(0,r.jsx)(n.li,{children:"Retry failed events from DLQ"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-3-wrong-destination-url",children:"Scenario 3: Wrong Destination URL"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Situation:"}),' Typo in destination URL, all webhooks failing with "Connection Refused".']}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Go to Destinations tab"}),"\n",(0,r.jsx)(n.li,{children:"Edit the destination"}),"\n",(0,r.jsx)(n.li,{children:"Fix the URL typo"}),"\n",(0,r.jsx)(n.li,{children:"Save changes"}),"\n",(0,r.jsx)(n.li,{children:"Return to DLQ and bulk retry"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-4-timeout-during-high-load",children:"Scenario 4: Timeout During High Load"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Situation:"})," Heavy traffic caused timeouts, some webhooks in DLQ."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Optimize webhook handler (process async)"}),"\n",(0,r.jsx)(n.li,{children:"Scale application servers"}),"\n",(0,r.jsx)(n.li,{children:"Add caching layer"}),"\n",(0,r.jsx)(n.li,{children:"Retry timed-out events from DLQ"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"debugging-failed-events",children:"Debugging Failed Events"}),"\n",(0,r.jsx)(n.h3,{id:"step-by-step-debugging",children:"Step-by-Step Debugging"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Click on failed event"})," to view details"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check the failed reason"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Connection issue? Check destination URL"}),"\n",(0,r.jsx)(n.li,{children:"Timeout? Optimize your handler"}),"\n",(0,r.jsx)(n.li,{children:"500 error? Check application logs"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Test destination URL"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://your-destination-url.com/webhook \\\n  -H "Content-Type: application/json" \\\n  -d \'{"test": true}\'\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Review application logs"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check around the timestamp"}),"\n",(0,r.jsx)(n.li,{children:"Look for exceptions or errors"}),"\n",(0,r.jsx)(n.li,{children:"Verify webhook was received"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Verify signature verification"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Make sure you're using correct endpoint token"}),"\n",(0,r.jsxs)(n.li,{children:["Check signature format: ",(0,r.jsx)(n.code,{children:"sha256={hash}"})]}),"\n",(0,r.jsx)(n.li,{children:"Validate timestamp tolerance"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix the issue"})," in your application"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Retry the event"})," from DLQ"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"using-event-details-for-debugging",children:"Using Event Details for Debugging"}),"\n",(0,r.jsx)(n.p,{children:"The event details modal shows everything you need:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "headers": {\n    "x-relae-signature": "sha256=abc123...",\n    "x-relae-timestamp": "1701234567",\n    "x-relae-source": "stripe",\n    "content-type": "application/json"\n  },\n  "body": {\n    // Full webhook payload\n  },\n  "metadata": {\n    "retry_count": 5,\n    "failed_reason": "Connection refused",\n    "last_retry_at": "2024-01-15T10:30:00Z"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"data-retention-in-dlq",children:"Data Retention in DLQ"}),"\n",(0,r.jsx)(n.p,{children:"Events in the DLQ follow your tier's retention policy:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Tier"}),(0,r.jsx)(n.th,{children:"DLQ Retention"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Builder"}),(0,r.jsx)(n.td,{children:"7 days"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Launch"}),(0,r.jsx)(n.td,{children:"14 days"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Scale"}),(0,r.jsx)(n.td,{children:"30 days"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"Custom"})]})]})]}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsxs)(n.p,{children:["Failed events are ",(0,r.jsx)(n.strong,{children:"automatically deleted"})," after the retention period. If you need to keep them:"]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Export the payload (copy/paste)"}),"\n",(0,r.jsx)(n.li,{children:"Store in your own systems"}),"\n",(0,r.jsx)(n.li,{children:"Or upgrade to a tier with longer retention"}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"preventing-dlq-events",children:"Preventing DLQ Events"}),"\n",(0,r.jsx)(n.p,{children:"The best strategy is to prevent events from reaching the DLQ:"}),"\n",(0,r.jsx)(n.h3,{id:"1-reliable-infrastructure",children:"1. Reliable Infrastructure"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use load balancers"}),"\n",(0,r.jsx)(n.li,{children:"Auto-scaling groups"}),"\n",(0,r.jsx)(n.li,{children:"Health checks"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-fast-webhook-handlers",children:"2. Fast Webhook Handlers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Return 200 immediately"}),"\n",(0,r.jsx)(n.li,{children:"Process asynchronously"}),"\n",(0,r.jsx)(n.li,{children:"Keep handlers under 5 seconds"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-error-handling",children:"3. Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'app.post("/webhooks", async (req, res) => {\n  try {\n    // Acknowledge immediately\n    res.status(200).send("OK");\n\n    // Process with error handling\n    await processWebhook(req.body);\n  } catch (error) {\n    // Log but don\'t throw\n    console.error("Webhook processing error:", error);\n    // Event still acknowledged successfully\n  }\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-monitoring",children:"4. Monitoring"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set up uptime monitoring"}),"\n",(0,r.jsx)(n.li,{children:"Track response times"}),"\n",(0,r.jsx)(n.li,{children:"Alert on elevated error rates"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-testing",children:"5. Testing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Test webhook endpoints regularly"}),"\n",(0,r.jsx)(n.li,{children:"Simulate failures in staging"}),"\n",(0,r.jsx)(n.li,{children:"Verify retry behavior"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/core-concepts/retries",children:"Understand Automatic Retries \u2192"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/core-concepts/events",children:"Learn About Events \u2192"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/guides/analytics",children:"View Analytics \u2192"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/guides/verifying-signatures",children:"Verify Signatures \u2192"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,r.jsx)(n.p,{children:"Having trouble with the DLQ?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udce7 Email: ",(0,r.jsx)(n.a,{href:"mailto:support@relaehook.com",children:"support@relaehook.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcac Check the ",(0,r.jsx)(n.a,{href:"/faq",children:"FAQ"})]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udc1b Report issues on ",(0,r.jsx)(n.a,{href:"https://github.com/WillBallentine/relae-docs/issues",children:"GitHub"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},3034:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dlq-dashboard-b15faf71cd3ee8d60787cbd06f10f708.png"},7327:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/bulk-retry-602f71d238401a4df430ce32f626df43.png"},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>d});var s=i(6540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);